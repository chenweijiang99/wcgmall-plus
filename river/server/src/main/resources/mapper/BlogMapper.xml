<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.river.mapper.BlogMapper">


    <select id="userGetNewBlogList" resultType="com.river.entity.Blog">
        select *
        from blog
        where status = 1
        order by create_time desc limit 6
    </select>
    <select id="userGetListPage" resultType="com.river.entity.Blog">
        select b.* ,u.avatar as userAvatar from blog as b
        left join sys_user as u on b.user_id = u.id
        <where>
            b.status = 1
            <if test="blogPageDto.searchTitles != null and blogPageDto.searchTitles.length > 0">
                AND (
                <foreach collection="blogPageDto.searchTitles" item="item" separator=" OR ">
                    b.title like concat('%',#{item},'%')
                </foreach>
                )
            </if>
            <if test="blogPageDto.authorNames != null and blogPageDto.authorNames.length > 0">
                AND (
                <foreach collection="blogPageDto.authorNames" item="item" separator=" OR ">
                    u.nickname like concat('%',#{item},'%')
                </foreach>
                )
            </if>
        </where>
        order by b.create_time desc
    </select>

    <select id="getHotBlogWithComment" resultType="com.river.entity.Blog">
        SELECT
            b.id as fid,
            COUNT(c.fid) AS COUNT,
        b.*
        FROM blog as b
            LEFT JOIN comments as c ON c.fid = b.id and c.module = 'blog'
        WHERE b.status = 1
        GROUP BY b.id
        ORDER BY COUNT DESC
            LIMIT 3

    </select>
    <select id="userGetListByUserId" resultType="com.river.entity.Blog">
        select b.*,u.avatar as userAvatar from blog as b
        left join sys_user as u on b.user_id = u.id
        where b.user_id = #{userId}  order by create_time desc
    </select>
    <select id="userGetDetail" resultType="com.river.entity.Blog">
        select b.*,u.avatar as userAvatar,u.signature as signature from blog as b
        left join sys_user as u on b.user_id = u.id
        where b.id = #{id}
    </select>
</mapper>
