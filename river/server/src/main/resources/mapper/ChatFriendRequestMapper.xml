<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.river.mapper.ChatFriendRequestMapper">

    <!-- 获取收到的好友申请列表 -->
    <select id="selectReceivedRequestList" resultType="com.river.vo.ChatFriendRequestVO">
        SELECT
            r.id,
            r.from_user_id AS fromUserId,
            r.from_user_type AS fromUserType,
            r.message,
            r.status,
            r.create_time AS createTime,
            CASE
                WHEN r.from_user_type = 1 THEN u.nickname
                WHEN r.from_user_type = 2 THEN a.nickname
            END AS fromUserNickname,
            CASE
                WHEN r.from_user_type = 1 THEN u.avatar
                WHEN r.from_user_type = 2 THEN a.avatar
            END AS fromUserAvatar
        FROM chat_friend_request r
        LEFT JOIN sys_user u ON r.from_user_type = 1 AND r.from_user_id = u.id
        LEFT JOIN sys_user a ON r.from_user_type = 2 AND r.from_user_id = a.id
        WHERE r.to_user_id = #{userId}
        AND r.to_user_type = #{userType}
        ORDER BY r.create_time DESC
    </select>

</mapper>
