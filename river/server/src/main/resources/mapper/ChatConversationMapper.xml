<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.river.mapper.ChatConversationMapper">

    <!-- 获取用户会话列表 -->
    <select id="selectConversationList" resultType="com.river.vo.ChatConversationVO">
        SELECT
            c.id,
            c.room_id AS roomId,
            r.type AS roomType,
            c.last_msg_content AS lastMsgContent,
            c.last_msg_time AS lastMsgTime,
            c.unread_count AS unreadCount,
            c.is_top AS isTop,
            c.is_muted AS isMuted,
            CASE
                WHEN r.type = 2 THEN r.name
                ELSE NULL
            END AS name,
            CASE
                WHEN r.type = 2 THEN r.avatar
                ELSE NULL
            END AS avatar
        FROM chat_conversation c
        INNER JOIN chat_room r ON c.room_id = r.id
        WHERE c.user_id = #{userId}
        AND c.user_type = #{userType}
        AND c.is_deleted = 0
        ORDER BY c.is_top DESC, c.last_msg_time DESC
    </select>

</mapper>
