<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.river.mapper.ChatFriendMapper">

    <!-- 获取好友列表(带用户信息) -->
    <select id="selectFriendListWithUserInfo" resultType="com.river.vo.ChatFriendVO">
        SELECT
            f.id,
            f.friend_id AS friendId,
            f.friend_type AS friendType,
            f.remark,
            f.room_id AS roomId,
            f.create_time AS createTime,
            CASE
                WHEN f.friend_type = 1 THEN u.nickname
                WHEN f.friend_type = 2 THEN a.nickname
            END AS nickname,
            CASE
                WHEN f.friend_type = 1 THEN u.avatar
                WHEN f.friend_type = 2 THEN a.avatar
            END AS avatar
        FROM chat_friend f
        LEFT JOIN sys_user u ON f.friend_type = 1 AND f.friend_id = u.id
        LEFT JOIN sys_user a ON f.friend_type = 2 AND f.friend_id = a.id
        WHERE f.user_id = #{userId}
        AND f.user_type = #{userType}
        AND f.status = 1
        ORDER BY f.create_time DESC
    </select>

</mapper>
